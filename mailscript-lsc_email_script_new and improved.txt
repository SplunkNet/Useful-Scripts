<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_email"><sys_script_email action="INSERT_OR_UPDATE"><name>lsc_email_script2</name><new_lines_to_html>false</new_lines_to_html><script><![CDATA[(function runMailScript(/* GlideRecord */ current, /* TemplatePrinter */ template,
          /* Optional EmailOutbound */ email, /* Optional GlideRecord */ email_action,
          /* Optional GlideRecord */ event) {
	
	var emailUser = gs.getProperty('glide.email.user');
	
	var item = new GlideRecord("sc_req_item");
	item.get(current.sysapproval);
	
	var keys = [];
	var set = new GlideappVariablePoolQuestionSet();
	set.setRequestID(item.sys_id);
	set.load();
	var vs = set.getFlatQuestions();

	function check(arg){
		if(arg == "Applications"){
			return true;
		}
		if(arg == "Roles"){
			return true;
		}
		if(arg == "Templates"){
			return true;
		}
		return false;
	}
	
	var CustomerName, BranchName, LoanNumber, LoanType, BankError, CustomerCourtesy, WaiverAmount, WaiverType;
	
	for (var i=0; i < vs.size(); i++) {
		if (JSUtil.notNil(vs.get(i).getLabel())) {		
			if(!check(vs.get(i).getLabel())){
				switch(String(vs.get(i).getName())){
					case "LSCName":
						CustomerName=i;
						break;
					case "LSCBRNum":
						BranchName=i;
						break;
					case "LSCLoanNum":
						LoanNumber=i;
						break;
					case "LSCLntype":
						LoanType=i;
						break;
					case "LSCBankErr":
						BankError=i;
						if(vs.get(BankError).getDisplayValue() == "true"){
							WaiverType=i;
						}
						break;
					case "LSCCustCurt":
						CustomerCourtesy=i;
						if(vs.get(CustomerCourtesy).getDisplayValue() == "true"){
							WaiverType=i;
						}
						break;
					case "LSCWaivAmnt":
						WaiverAmount=i;
						break;
				  }
			}
		}
	}

	template.print('<p>Please review the following fee waiver request. Click the appropriate buttons to send an approval or rejection.</p>');
	template.print('<table cellspacing="0" cellpadding="3" border="1">');
	template.print('<tr><td width="130" style="font-weight:bold">' + vs.get(CustomerName).getLabel().replace('?',':') + '</td><td width="300">' + vs.get(CustomerName).getDisplayValue() + '</td></tr>');
	template.print('<tr><td width="130" style="font-weight:bold">' + vs.get(BranchName).getLabel().replace('?',':') + '</td><td width="300">' + vs.get(BranchName).getDisplayValue() + '</td></tr>');
	template.print('<tr><td width="130" style="font-weight:bold">' + vs.get(LoanNumber).getLabel().replace('?',':') + '</td><td width="300">' + vs.get(LoanNumber).getDisplayValue() + '</td></tr>');	
	template.print('<tr><td width="130" style="font-weight:bold">' + vs.get(LoanType).getLabel().replace('?',':') + '</td><td width="300">' + vs.get(LoanType).getDisplayValue() + '</td></tr>');	
	template.print('<tr><td width="130" style="font-weight:bold">Waiver Type:</td><td width="300">' + vs.get(WaiverType).getLabel().replace('?','') + '</td></tr>');
	template.print('<tr><td width="130" style="font-weight:bold">' + vs.get(WaiverAmount).getLabel().replace('?',':') + '</td><td width="300">$' + vs.get(WaiverAmount).getDisplayValue() + '</td></tr>');	
	template.print('</table>');

	//var answer = '<table><tr><td><p>&nbsp;</p></td></tr><tr><td bgcolor="#00cc00" style="width:80px; padding: 12px 10px 12px 10px;" align="center"><a href="mailto:'+emailUser+'?subject=Re%3A${sysapproval}%20-%20approve&body=%0A%0A'+email.watermark+'" style="font-size: 16px; font-family: Helvetica, Arial, sans-serif; font-weight: bold; color: #ffffff; text-decoration: none; display: inline-block;">Approve</a></td><td>&nbsp;&nbsp;<td><td bgcolor="#cc0000" style="width:80px;padding: 12px 18px 12px 18px;" align="center"><a href="mailto:'+emailUser+'?subject=Re%3A${sysapproval}%20-%20reject&body=%0A%0A'+email.watermark+'" style="font-size: 16px; font-family: Helvetica, Arial, sans-serif; font-weight: bold; color: #ffffff; text-decoration: none; display: inline-block;">Reject</a></td></tr></table>';
	//template.print(answer);
	
})(current, template, email, email_action, event);]]></script><sys_class_name>sys_script_email</sys_class_name><sys_created_by>e804771</sys_created_by><sys_created_on>2017-12-19 18:10:41</sys_created_on><sys_customer_update>false</sys_customer_update><sys_id>a03605cf4fcb0340937601b28110c772</sys_id><sys_mod_count>0</sys_mod_count><sys_name>lsc_email_script2</sys_name><sys_package display_value="Global" source="global">global</sys_package><sys_policy/><sys_replace_on_upgrade>false</sys_replace_on_upgrade><sys_scope display_value="Global">global</sys_scope><sys_update_name>sys_script_email_a03605cf4fcb0340937601b28110c772</sys_update_name><sys_updated_by>e804771</sys_updated_by><sys_updated_on>2017-12-19 18:10:41</sys_updated_on></sys_script_email></record_update>